#!/usr/bin/env zsh

set -e

spaces=4

while getopts 's:' opt; do
    case $opt in
        s) spaces=$OPTARG ;;
    esac
done

spaces=$(printf ' %.0s' {1..$spaces})
shift $((OPTIND-1))

if [[ ${#@} -eq 0 ]]; then
    echo 'No files specified.' >&2
    exit 1
fi

dos2unix $@
gsed -r -i "s/(($spaces)*)\\t/\\1$spaces/g;s/ +$//;\$a\\" $@
