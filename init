#!/usr/bin/env ruby

require 'pathname'

LINKS = %w{ghc/ghci.conf gitconfig gitignore i3 nvim nvimrc vimrc zlogin zlogout zprezto zpreztorc zprofile zshenv zshrc}

@dotfiles = Pathname.new(File.dirname(__FILE__)).realpath
@home = Pathname.new(ENV['HOME']).realpath

def run command
  unless system command
    $stderr.puts "FAIL: #{command}"
    exit 1
  end
end

def link source, destination
  destination.unlink if destination.exist?
  File.symlink source, destination
end

puts 'Symlinking configuration files'
LINKS.each do |file|
  link (@dotfiles + file), (@home + ".#{file}")
end

puts 'Installing vim plugins'
unless (@home + '.vim/bundle/vundle').exist?
  run 'git clone https://github.com/gmarik/vundle.git ~/.vim/bundle/vundle'
end
run 'vim +BundleInstall +BundleUpdate +qall'
