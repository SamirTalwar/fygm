#!/usr/bin/env ruby

require 'pathname'

def run command
  unless system command
    $stderr.puts "FAIL: #{command}"
    exit 1
  end
end

dotfiles = Pathname.new(File.dirname(__FILE__)).realpath
home = Pathname.new(ENV['HOME']).realpath

puts 'Setting up Prezto'
Pathname.glob(dotfiles + 'zprezto/runcoms/z*') \
  .reject { |file| (dotfiles + file.basename).exist? } \
  .each do |file|
    name = file.basename
    run "ln -sf '#{file}' '#{home}/.#{name}'"
  end

puts 'Symlinking configuration files'
exclude = %w{init README.md}.collect { |file| dotfiles + file }
(Pathname.glob(dotfiles + '*') - exclude).each do |dotfile|
  name = File.basename dotfile
  run "ln -sf '#{dotfile}' '#{home}/.#{name}'"
end

puts 'Installing vim plugins'
unless (home + '.vim/bundle/vundle').exist?
  run 'git clone https://github.com/gmarik/vundle.git ~/.vim/bundle/vundle'
end
run 'vim +BundleInstall +BundleUpdate +qall'
