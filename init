#!/usr/bin/env ruby

def run command
  unless system command
    $stderr.puts "FAIL: #{command}"
    exit 1
  end
end

dotfiles = File.expand_path File.dirname __FILE__
home = ENV['HOME']

puts "Setting up Prezto"
Dir["#{dotfiles}/zprezto/runcoms/z*"]
  .reject { |file| File.exists? "#{dotfiles}/#{File.basename(file)}" }
  .each do |file|
    name = File.basename file
    run "ln -sf '#{file}' '#{home}/.#{name}'"
  end

puts "Symlinking configuration files"
exclude = %w{init README.md}.collect { |file| "#{dotfiles}/#{file}" }
(Dir["#{dotfiles}/*"] - exclude).each do |dotfile|
  name = File.basename dotfile
  run "ln -sf '#{dotfile}' '#{home}/.#{name}'"
end

puts "Installing vim plugins"
unless File.exist? "#{home}/.vim/bundle/vundle"
  run "git clone https://github.com/gmarik/vundle.git ~/.vim/bundle/vundle"
end
run "vim +BundleInstall +BundleUpdate +qall"
